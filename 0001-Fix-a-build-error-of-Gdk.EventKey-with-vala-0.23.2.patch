From 67343c621eb5b19bfba40d3b3af6ddacf7032e1c Mon Sep 17 00:00:00 2001
From: fujiwarat <takao.fujiwara1@gmail.com>
Date: Fri, 21 Feb 2014 11:45:55 +0900
Subject: [PATCH] Fix a build error of Gdk.EventKey with vala 0.23.2

Review URL: https://codereview.appspot.com/66480044
---
 ui/gtk3/switcher.vala | 22 +++++++++++++++++-----
 1 file changed, 17 insertions(+), 5 deletions(-)

diff --git a/ui/gtk3/switcher.vala b/ui/gtk3/switcher.vala
index c606682..d7f7366 100644
--- a/ui/gtk3/switcher.vala
+++ b/ui/gtk3/switcher.vala
@@ -340,21 +340,29 @@ class Switcher : Gtk.Window {
 
     public override bool key_press_event(Gdk.EventKey e) {
         bool retval = true;
+
+/* Gdk.EventKey is changed to the pointer.
+ * https://git.gnome.org/browse/vala/commit/?id=598942f1
+ */
+#if VALA_0_24
+        Gdk.EventKey pe = e;
+#else
         Gdk.EventKey *pe = &e;
+#endif
 
         if (m_popup_delay_time > 0) {
             restore_window_position("pressed");
         }
 
         do {
-            uint modifiers = KeybindingManager.MODIFIER_FILTER & pe->state;
+            uint modifiers = KeybindingManager.MODIFIER_FILTER & pe.state;
 
             if ((modifiers != m_modifiers) &&
                 (modifiers != (m_modifiers | Gdk.ModifierType.SHIFT_MASK))) {
                 break;
             }
 
-            if (pe->keyval == m_keyval) {
+            if (pe.keyval == m_keyval) {
                 if (modifiers == m_modifiers)
                     next_engine();
                 else // modififers == m_modifiers | SHIFT_MASK
@@ -362,7 +370,7 @@ class Switcher : Gtk.Window {
                 break;
             }
 
-            switch (pe->keyval) {
+            switch (pe.keyval) {
                 case 0x08fb: /* leftarrow */
                 case 0xff51: /* Left */
                     previous_engine();
@@ -378,7 +386,7 @@ class Switcher : Gtk.Window {
                 case 0xff54: /* Down */
                     break;
                 default:
-                    debug("0x%04x", pe->keyval);
+                    debug("0x%04x", pe.keyval);
                     if (m_loop != null) {
                         m_loop.quit();
                         m_loop = null;
@@ -391,9 +399,13 @@ class Switcher : Gtk.Window {
     }
 
     public override bool key_release_event(Gdk.EventKey e) {
+#if VALA_0_24
+        Gdk.EventKey pe = e;
+#else
         Gdk.EventKey *pe = &e;
+#endif
 
-        if (KeybindingManager.primary_modifier_still_pressed((Gdk.Event *)pe,
+        if (KeybindingManager.primary_modifier_still_pressed((Gdk.Event) pe,
             m_primary_modifier)) {
             return true;
         }
-- 
2.4.3

